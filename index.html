<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f1117">
<title>Vibenith</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
:root{
  --bg:#0f1117;--surf:#161b26;--col:#1c2130;--card:#222840;--brd:#283048;--brd2:#3a4560;
  --tx:#eceef5;--mut:#5a6280;--mut2:#8a94b8;--dim:#2e3650;
  --acc:#4f7bff;--grn:#22d3a0;--red:#ff5263;--ylw:#ffc542;--pur:#a78bfa;--cyn:#22d3ee;
  --r:16px;--r2:12px;
  --safe-t:env(safe-area-inset-top,0px);
  --safe-b:env(safe-area-inset-bottom,0px);
  --nav-h:64px;
  --topbar-h:56px;
}
html{height:100%;background:var(--bg)}
body{height:100%;font-family:'Outfit',sans-serif;overscroll-behavior:none;-webkit-text-size-adjust:100%;background:var(--bg);color:var(--tx);user-select:none}
textarea,input{user-select:text}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• APP SHELL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app{
  display:flex;flex-direction:column;
  height:100vh;height:100dvh;
  overflow:hidden;
  padding-top:var(--safe-t);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOPBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.topbar{
  height:var(--topbar-h);
  background:var(--surf);
  display:flex;align-items:center;
  padding:0 16px;gap:10px;
  flex-shrink:0;position:relative;z-index:40;
  border-bottom:1px solid var(--brd);
}
.tb-logo{
  width:34px;height:34px;
  background:linear-gradient(135deg,#c8892a,#f0b040);
  border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-size:17px;flex-shrink:0;
  box-shadow:0 4px 16px rgba(200,137,42,.4);
}
.tb-title{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;color:var(--tx);flex:1;letter-spacing:-.01em}
.tb-action{
  width:36px;height:36px;background:var(--col);border:1px solid var(--brd);
  border-radius:10px;display:flex;align-items:center;justify-content:center;
  color:var(--mut2);cursor:pointer;border:none;flex-shrink:0;
  transition:background .15s,color .15s;
}
.tb-action:active{background:var(--brd);color:var(--tx)}
/* Desktop: show extra buttons */
.tb-desktop-row{display:none;align-items:center;gap:6px}
@media(min-width:768px){
  .tb-desktop-row{display:flex}
  .tb-action.menu-only{display:none}
}
.dsk-btn{display:inline-flex;align-items:center;gap:5px;padding:6px 12px;border-radius:8px;font-family:'Syne',sans-serif;font-size:11px;font-weight:700;cursor:pointer;border:none;transition:all .15s;white-space:nowrap}
.dsk-ghost{background:transparent;color:var(--mut);border:1px solid var(--brd)}
.dsk-ghost:hover{background:var(--col);color:var(--tx)}
.dsk-warn{background:transparent;color:var(--ylw);border:1px solid rgba(255,197,66,.2)}
.dsk-warn:hover{background:rgba(255,197,66,.07)}
.dsk-acc{background:var(--acc);color:#fff}
.dsk-acc:hover{background:#3a66ee}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE TITLE (per screen) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen-hdr{
  padding:16px 18px 8px;
  display:flex;align-items:center;justify-content:space-between;
  flex-shrink:0;
}
.screen-hdr-title{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:var(--tx);letter-spacing:-.02em}
.screen-hdr-sub{font-size:12px;color:var(--mut);margin-top:2px}
.hdr-btn{
  display:flex;align-items:center;gap:6px;
  padding:8px 14px;border-radius:10px;
  background:var(--acc);color:#fff;border:none;
  font-family:'Syne',sans-serif;font-size:12px;font-weight:700;
  cursor:pointer;transition:all .15s;
}
.hdr-btn:active{transform:scale(.95);background:#3a66ee}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BOTTOM NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav{
  height:calc(var(--nav-h) + var(--safe-b));
  background:var(--surf);
  border-top:1px solid var(--brd);
  display:flex;align-items:flex-start;
  padding-top:8px;
  padding-bottom:var(--safe-b);
  flex-shrink:0;z-index:40;
  /* desktop: hide bottom nav, show top tabs */
}
@media(min-width:768px){.bottom-nav{display:none}}
.nav-item{
  flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;
  padding:0 4px;cursor:pointer;border:none;background:transparent;
  transition:transform .15s;
}
.nav-item:active{transform:scale(.9)}
.nav-icon{
  width:28px;height:28px;display:flex;align-items:center;justify-content:center;
  border-radius:9px;transition:background .2s;
  font-size:18px;
}
.nav-item.active .nav-icon{background:rgba(79,123,255,.15)}
.nav-lbl{font-family:'Syne',sans-serif;font-size:10px;font-weight:700;color:var(--mut);letter-spacing:.03em;transition:color .2s}
.nav-item.active .nav-lbl{color:var(--acc)}
.nav-badge{
  position:absolute;top:-4px;right:-4px;
  background:var(--red);color:#fff;
  border-radius:99px;font-size:9px;font-weight:800;font-family:'Syne',sans-serif;
  padding:1px 5px;min-width:16px;text-align:center;
  border:2px solid var(--surf);
  display:none;
}
.nav-badge.show{display:block}
.nav-ico-wrap{position:relative}

/* Desktop: top tab bar replaces bottom nav */
.top-tab-bar{display:none;background:var(--surf);border-bottom:1px solid var(--brd);flex-shrink:0}
@media(min-width:768px){.top-tab-bar{display:flex}}
.top-tab-btn{flex:1;padding:13px 16px;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:var(--mut);border:none;background:transparent;border-bottom:2px solid transparent;transition:color .2s,border-color .2s;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px}
.top-tab-btn.active{color:var(--acc);border-bottom-color:var(--acc)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCROLL BODY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app-body{flex:1;overflow:hidden;position:relative}
.screen{position:absolute;inset:0;display:flex;flex-direction:column;overflow:hidden;opacity:0;pointer-events:none;transform:translateY(8px);transition:opacity .22s,transform .22s}
.screen.active{opacity:1;pointer-events:all;transform:translateY(0)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• KANBAN SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#scr-tarefas{flex-direction:column}
.kanban-sub-nav{
  display:flex;gap:0;background:var(--col);margin:12px 16px 0;
  border-radius:12px;padding:3px;flex-shrink:0;
  border:1px solid var(--brd);
}
.ksn-btn{
  flex:1;padding:8px 4px;border-radius:9px;border:none;background:transparent;
  font-family:'Syne',sans-serif;font-size:11px;font-weight:700;color:var(--mut);
  cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:5px;
}
.ksn-btn.active{background:var(--surf);color:var(--tx);box-shadow:0 2px 8px rgba(0,0,0,.3)}
.ksn-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.ksn-cnt{background:var(--dim);color:var(--mut);border-radius:99px;font-size:9px;font-weight:800;padding:1px 5px;font-family:'Syne',sans-serif}
.ksn-btn.active .ksn-cnt{background:rgba(79,123,255,.15);color:var(--acc)}

.board-container{flex:1;overflow:hidden;position:relative}
/* Mobile: one column at a time, swipeable */
.board{
  display:flex;
  height:100%;
  transition:transform .3s cubic-bezier(.4,0,.2,1);
}
.k-col{
  width:100%;flex-shrink:0;
  display:flex;flex-direction:column;
  height:100%;
  padding:10px 14px;
  gap:0;
}
/* Desktop: side by side */
@media(min-width:768px){
  .board{flex-wrap:nowrap;overflow-x:auto;scrollbar-width:thin;scrollbar-color:var(--brd) transparent;height:auto;transform:none!important}
  .board::-webkit-scrollbar{height:5px}
  .board::-webkit-scrollbar-thumb{background:var(--brd);border-radius:99px}
  .k-col{width:300px;height:auto;max-height:calc(100vh - 200px);padding:10px 0 10px 14px}
  .k-col:last-of-type{padding-right:14px}
}
.k-col-head{
  display:flex;align-items:center;gap:8px;
  padding:0 2px 10px;flex-shrink:0;
}
.k-col-dot{width:9px;height:9px;border-radius:50%;flex-shrink:0}
.k-col-name{
  font-family:'Syne',sans-serif;font-size:13px;font-weight:800;
  color:var(--tx);background:transparent;border:none;outline:none;
  flex:1;min-width:0;letter-spacing:.01em;
}
.k-col-name[readonly]{cursor:default}
.k-col-cnt{
  background:var(--col);color:var(--mut);border-radius:99px;
  font-size:11px;font-weight:700;padding:3px 9px;border:1px solid var(--brd);
  font-family:'Syne',sans-serif;flex-shrink:0;
}
.k-col-del{width:26px;height:26px;background:transparent;border:none;border-radius:7px;cursor:pointer;color:var(--mut);display:flex;align-items:center;justify-content:center;opacity:.5;transition:all .15s;flex-shrink:0}
.k-col-del:active{background:rgba(255,82,99,.12);color:var(--red);opacity:1}

.cards-list{
  flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;
  display:flex;flex-direction:column;gap:10px;
  padding:4px 2px 80px;
  scrollbar-width:none;
}
.cards-list::-webkit-scrollbar{display:none}
.cards-list.drag-over{background:rgba(79,123,255,.04);border-radius:12px;outline:2px dashed rgba(79,123,255,.3)}

/* â”€â”€ CARD â”€â”€ */
.card{
  background:var(--card);border:1px solid var(--brd);
  border-radius:var(--r);padding:14px;
  display:flex;flex-direction:column;gap:10px;
  position:relative;overflow:hidden;
  transition:transform .18s,box-shadow .18s,opacity .2s;
  cursor:default;
}
.card-accent{position:absolute;top:0;left:0;right:0;height:3px;border-radius:var(--r) var(--r) 0 0;background:var(--acc)}
.card.s-prog .card-accent{background:var(--ylw);animation:ppls 2s ease-in-out infinite}
.card.s-done .card-accent{background:var(--grn)}
@keyframes ppls{0%,100%{opacity:1}50%{opacity:.4}}
.card:active{transform:scale(.98);box-shadow:0 2px 12px rgba(0,0,0,.3)}
.card.s-prog{border-color:rgba(255,197,66,.15)}
.card.s-done{border-color:rgba(34,211,160,.12);background:rgba(34,211,160,.012)}
.card.dragging{opacity:.25;transform:scale(.96) rotate(1deg)}

.card-top{display:flex;align-items:flex-start;gap:8px}
.card-title{
  font-family:'Syne',sans-serif;font-size:14px;font-weight:700;color:var(--tx);
  border:none;background:transparent;outline:none;width:100%;resize:none;
  line-height:1.4;padding:0;border-radius:4px;min-height:20px;overflow:hidden;
}
.s-done .card-title{text-decoration:line-through;color:var(--grn);opacity:.8}
.card-del{
  flex-shrink:0;width:28px;height:28px;background:rgba(255,82,99,.08);
  border:none;border-radius:8px;cursor:pointer;color:var(--red);
  display:flex;align-items:center;justify-content:center;opacity:.6;transition:opacity .15s;
}
.card-del:active{opacity:1;background:rgba(255,82,99,.2)}

.card-desc{
  font-size:13px;color:var(--mut2);border:none;background:transparent;outline:none;
  width:100%;resize:none;line-height:1.6;padding:0;min-height:16px;overflow:hidden;
  font-family:'Outfit',sans-serif;
}
.card-desc::placeholder{color:var(--mut)}

.tags-row{display:flex;flex-wrap:wrap;gap:5px;align-items:center}
.tag{font-size:11px;font-weight:600;padding:3px 9px;border-radius:99px;display:flex;align-items:center;gap:4px}
.tag .tdel{font-size:14px;opacity:.6;cursor:pointer;margin-left:1px}
.tag .tdel:active{opacity:1}
.tag.blue{background:rgba(79,123,255,.13);color:var(--acc);border:1px solid rgba(79,123,255,.25)}
.tag.green{background:rgba(34,211,160,.12);color:var(--grn);border:1px solid rgba(34,211,160,.25)}
.tag.yellow{background:rgba(255,197,66,.12);color:var(--ylw);border:1px solid rgba(255,197,66,.25)}
.tag.red{background:rgba(255,82,99,.12);color:var(--red);border:1px solid rgba(255,82,99,.25)}
.tag.purple{background:rgba(167,139,250,.12);color:var(--pur);border:1px solid rgba(167,139,250,.25)}
.tag.gray{background:rgba(255,255,255,.06);color:var(--mut2);border:1px solid var(--brd)}
.add-tag-btn{font-size:11px;color:var(--mut);border:1px dashed var(--brd);background:transparent;border-radius:99px;padding:3px 9px;cursor:pointer;transition:all .15s}
.add-tag-btn:active{color:var(--acc);border-color:rgba(79,123,255,.4)}

.card-date{
  font-size:12px;background:var(--col);border-radius:8px;padding:5px 10px;
  color:var(--mut2);outline:none;font-family:'Outfit',sans-serif;
  border:1px solid var(--brd);color-scheme:dark;width:100%;
}

/* TIMER */
.timer-box{
  background:rgba(255,197,66,.06);border:1px solid rgba(255,197,66,.15);
  border-radius:10px;padding:10px 12px;display:flex;align-items:center;gap:10px;
}
.timer-display{
  font-family:'Syne',sans-serif;font-size:20px;font-weight:800;
  color:var(--ylw);letter-spacing:.04em;flex:1;font-variant-numeric:tabular-nums;
}
.timer-btns{display:flex;gap:7px}
.timer-btn{
  width:34px;height:34px;border-radius:9px;border:none;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;transition:all .15s;flex-shrink:0;
}
.timer-btn:active{transform:scale(.88)}
.t-play{background:rgba(255,197,66,.18);color:var(--ylw)}
.t-play:active{background:rgba(255,197,66,.35)}
.t-reset{background:rgba(255,255,255,.06);color:var(--mut2)}
.t-reset:active{background:rgba(255,255,255,.14)}
.timer-running .timer-display{animation:tpulse 1s ease-in-out infinite}
@keyframes tpulse{0%,100%{opacity:1}50%{opacity:.55}}

/* STATUS BUTTONS */
.status-row{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.status-row.one{grid-template-columns:1fr}
.sb{
  padding:10px 6px;border-radius:10px;
  font-family:'Syne',sans-serif;font-size:12px;font-weight:700;
  border:none;display:flex;align-items:center;justify-content:center;gap:5px;
  cursor:pointer;transition:all .15s;white-space:nowrap;
}
.sb:active{transform:scale(.95)}
.sb-prog{background:rgba(255,197,66,.1);color:var(--ylw);border:1px solid rgba(255,197,66,.2)}
.sb-prog.on{background:rgba(255,197,66,.18);border-color:rgba(255,197,66,.35);cursor:default}
.sb-done{background:rgba(34,211,160,.1);color:var(--grn);border:1px solid rgba(34,211,160,.18)}
.sb-done.on{background:rgba(34,211,160,.18);border-color:rgba(34,211,160,.35);cursor:default}
.sb-undo{background:rgba(255,82,99,.07);color:var(--red);border:1px solid rgba(255,82,99,.15);width:100%}
.sb-undo:active{background:rgba(255,82,99,.15)}

/* ADD CARD BUTTON & FORM */
.add-card-area{padding:4px 2px 0;flex-shrink:0}
.open-add-btn{
  width:100%;padding:12px;border:1.5px dashed var(--brd);border-radius:var(--r);
  background:transparent;color:var(--mut);font-size:13px;font-family:'Outfit',sans-serif;
  cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;
  transition:all .15s;
}
.open-add-btn:active{background:rgba(79,123,255,.05);color:var(--acc);border-color:rgba(79,123,255,.4)}
.add-form{
  display:none;flex-direction:column;gap:8px;
  background:var(--surf);border-radius:var(--r);padding:12px;
  border:1px solid var(--brd2);margin-bottom:0;
}
.add-form.open{display:flex}
.af-inp{
  border:1px solid var(--brd);border-radius:10px;padding:11px 13px;
  font-size:14px;font-family:'Outfit',sans-serif;outline:none;width:100%;
  background:var(--col);color:var(--tx);transition:border .15s;resize:none;
  -webkit-appearance:none;
}
.af-inp:focus{border-color:var(--acc)}
.af-inp::placeholder{color:var(--mut)}
.af-btns{display:flex;gap:8px}
.af-save{
  flex:1;padding:11px;background:var(--acc);color:#fff;border:none;
  border-radius:10px;font-family:'Syne',sans-serif;font-weight:700;font-size:13px;
  cursor:pointer;
}
.af-save:active{background:#3a66ee}
.af-cancel{
  padding:11px 16px;background:transparent;color:var(--mut);
  border:1px solid var(--brd);border-radius:10px;
  font-family:'Syne',sans-serif;font-weight:700;font-size:13px;cursor:pointer;
}

/* ADD COL BUTTON (desktop only) */
.add-col-wrap{width:260px;flex-shrink:0;padding:10px 14px 10px 0;display:none}
@media(min-width:768px){.add-col-wrap{display:block}}
.add-col-btn{
  width:100%;height:100%;min-height:120px;border:2px dashed var(--brd);border-radius:var(--r);
  background:transparent;color:var(--mut);font-size:13px;font-family:'Outfit',sans-serif;
  cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;transition:all .15s;
}
.add-col-btn:hover{background:rgba(79,123,255,.03);color:var(--acc);border-color:rgba(79,123,255,.4)}

/* FAB â€” add task (mobile) */
.fab{
  position:fixed;bottom:calc(var(--nav-h) + var(--safe-b) + 14px);right:18px;
  z-index:60;width:52px;height:52px;border-radius:16px;
  background:linear-gradient(135deg,var(--acc),#7b5fff);color:#fff;border:none;
  box-shadow:0 8px 24px rgba(79,123,255,.5);
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;transition:transform .2s,box-shadow .2s;
}
.fab:active{transform:scale(.9);box-shadow:0 4px 12px rgba(79,123,255,.4)}
@media(min-width:768px){.fab{display:none!important}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAINEL SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#scr-painel .scr-scroll{padding:0 16px 24px}
.panel-widget{
  background:var(--card);border:1px solid var(--brd);
  border-radius:var(--r);padding:18px;margin-bottom:12px;
}
.pw-title{
  font-family:'Syne',sans-serif;font-size:11px;font-weight:700;
  text-transform:uppercase;letter-spacing:.12em;color:var(--mut);
  margin-bottom:14px;display:flex;align-items:center;
}
.stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
@media(min-width:500px){.stats-grid{grid-template-columns:repeat(4,1fr)}}
.stat-box{background:var(--col);border-radius:12px;padding:14px;border:1px solid var(--brd)}
.stat-lbl{font-size:11px;color:var(--mut);margin-bottom:5px;font-family:'Outfit',sans-serif}
.stat-val{font-family:'Syne',sans-serif;font-size:26px;font-weight:800}
.sv-blue{color:var(--acc)}.sv-yellow{color:var(--ylw)}.sv-green{color:var(--grn)}.sv-purple{color:var(--pur)}
.prog-wrap{background:var(--col);border-radius:99px;height:7px;overflow:hidden;border:1px solid var(--brd);margin-top:14px}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--acc),var(--grn));border-radius:99px;transition:width .6s cubic-bezier(.4,0,.2,1)}
.pie-row{display:flex;align-items:center;gap:20px;flex-wrap:wrap}
.pie-legend{display:flex;flex-direction:column;gap:9px;flex:1;min-width:120px}
.legend-item{display:flex;align-items:center;gap:8px;font-size:12.5px;color:var(--mut2)}
.legend-dot{width:9px;height:9px;border-radius:2px;flex-shrink:0}
.legend-val{margin-left:auto;font-family:'Syne',sans-serif;font-weight:700;color:var(--tx);font-size:13px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ÃGUA SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.water-big{font-family:'Syne',sans-serif;font-size:52px;font-weight:800;color:var(--cyn);line-height:1;text-align:center}
.water-of{font-family:'Syne',sans-serif;font-size:18px;color:var(--mut);font-weight:700}
.water-ml{font-size:13px;color:var(--mut);text-align:center;margin-top:4px}
.w-bar-wrap{background:var(--col);border-radius:99px;height:8px;overflow:hidden;border:1px solid var(--brd)}
.w-bar-fill{height:100%;background:linear-gradient(90deg,#38bdf8,#0ea5e9);border-radius:99px;transition:width .4s ease}
.water-cups{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:4px 0}
.cup{
  width:36px;height:44px;border-radius:5px 5px 9px 9px;border:2px solid var(--brd);
  background:var(--col);position:relative;overflow:hidden;cursor:pointer;
  transition:transform .15s,border-color .2s;
}
.cup::after{content:'';position:absolute;bottom:0;left:0;right:0;height:0;background:linear-gradient(180deg,#38bdf8,#0ea5e9);transition:height .35s cubic-bezier(.4,0,.2,1)}
.cup.filled{border-color:rgba(34,211,238,.5)}.cup.filled::after{height:100%}
.cup:active{transform:scale(1.12)}
.water-acts{display:flex;gap:10px}
.wa-btn{flex:1;padding:13px;border-radius:12px;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;border:none;cursor:pointer;transition:all .15s}
.wa-btn:active{transform:scale(.95)}
.wa-add{background:rgba(34,211,238,.12);color:var(--cyn);border:1px solid rgba(34,211,238,.25)}
.wa-reset{background:rgba(255,255,255,.05);color:var(--mut);border:1px solid var(--brd)}
.wa-goal-btn{background:var(--col);color:var(--mut2);border:1px solid var(--brd);border-radius:10px;padding:10px 14px;font-size:14px;cursor:pointer}
.wa-goal-btn:active{background:var(--brd)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• METAS SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.yr-badge{font-family:'Syne',sans-serif;font-size:12px;color:var(--acc);font-weight:700;background:rgba(79,123,255,.1);border:1px solid rgba(79,123,255,.2);border-radius:8px;padding:4px 11px}
.goal-card{background:var(--card);border:1px solid var(--brd);border-radius:var(--r);padding:16px;display:flex;flex-direction:column;gap:11px;margin-bottom:10px}
.goal-card.done-g{opacity:.55}
.gc-top{display:flex;align-items:flex-start;gap:8px}
.gc-title{font-family:'Syne',sans-serif;font-size:14px;font-weight:700;color:var(--tx);background:transparent;border:none;outline:none;flex:1;resize:none;line-height:1.4;min-height:20px;overflow:hidden;padding:0}
.done-g .gc-title{text-decoration:line-through;color:var(--mut)}
.gc-del{flex-shrink:0;width:30px;height:30px;background:rgba(255,82,99,.07);border:none;border-radius:8px;cursor:pointer;color:var(--red);display:flex;align-items:center;justify-content:center;opacity:.6;transition:all .15s}
.gc-del:active{background:rgba(255,82,99,.2);opacity:1}
.gc-meta{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.gc-cat{font-size:11px;font-weight:600;padding:4px 10px;border-radius:99px}
.gc-date{font-size:12px;background:var(--col);border-radius:8px;padding:5px 10px;color:var(--mut);outline:none;font-family:'Outfit',sans-serif;border:1px solid var(--brd);color-scheme:dark;-webkit-appearance:none}
.gc-prog-row{display:flex;align-items:center;gap:10px}
.gc-prog-bar{flex:1;height:7px;background:var(--col);border-radius:99px;overflow:hidden;border:1px solid var(--brd)}
.gc-prog-fill{height:100%;border-radius:99px;transition:width .4s ease}
.gc-prog-inp{width:55px;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--tx);background:var(--col);border:1px solid var(--brd);border-radius:8px;padding:5px 7px;outline:none;text-align:center;-webkit-appearance:none}
.gc-prog-inp:focus{border-color:var(--acc)}
.gc-check{width:100%;padding:12px;border-radius:11px;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;display:flex;align-items:center;justify-content:center;gap:6px;border:none;cursor:pointer;transition:all .15s}
.gc-check:active{transform:scale(.97)}
.gc-no{background:rgba(255,255,255,.05);color:var(--mut);border:1px solid var(--brd)}
.gc-yes{background:rgba(34,211,160,.12);color:var(--grn);border:1px solid rgba(34,211,160,.27)}
.add-goal-box{background:var(--col);border:1px solid var(--brd);border-radius:var(--r);padding:16px;display:flex;flex-direction:column;gap:10px;margin-bottom:30px}
.ag-inp{background:var(--surf);border:1px solid var(--brd);border-radius:10px;padding:12px 14px;font-size:14px;font-family:'Outfit',sans-serif;color:var(--tx);outline:none;width:100%;transition:border .15s;-webkit-appearance:none}
.ag-inp:focus{border-color:var(--acc)}
.ag-inp::placeholder{color:var(--mut)}
.ag-sel{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%235a6280' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:36px;-webkit-appearance:none}
.ag-save{width:100%;padding:13px;background:var(--acc);color:#fff;border:none;border-radius:11px;font-family:'Syne',sans-serif;font-weight:700;font-size:14px;cursor:pointer;transition:background .15s}
.ag-save:active{background:#3a66ee}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SHARED â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.scr-scroll{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;padding-bottom:24px}
.scr-scroll::-webkit-scrollbar{display:none}

/* â”€â”€ SHEET (add card / modals) â”€â”€ */
.sheet-ov{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:149;display:none;backdrop-filter:blur(4px)}
.sheet-ov.open{display:block}
.bottom-sheet{
  position:fixed;bottom:0;left:0;right:0;
  background:var(--surf);border-radius:24px 24px 0 0;
  border:1px solid var(--brd);z-index:150;
  padding:20px 20px calc(20px + var(--safe-b));
  transform:translateY(100%);transition:transform .35s cubic-bezier(.4,0,.2,1);
  max-height:90vh;overflow-y:auto;
}
.bottom-sheet.open{transform:translateY(0)}
.sh-handle{width:36px;height:4px;background:var(--brd2);border-radius:99px;margin:0 auto 20px}
.sh-title{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;margin-bottom:20px}
.sh-field{display:flex;flex-direction:column;gap:7px;margin-bottom:14px}
.sh-lbl{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.09em;color:var(--mut)}
.sh-inp{background:var(--col);border:1px solid var(--brd);border-radius:12px;padding:14px;font-size:15px;font-family:'Outfit',sans-serif;color:var(--tx);outline:none;width:100%;transition:border .15s;-webkit-appearance:none}
.sh-inp:focus{border-color:var(--acc)}
.sh-inp::placeholder{color:var(--mut)}
.sh-sel{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%235a6280' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:40px;-webkit-appearance:none}
.sh-acts{display:flex;gap:10px;margin-top:6px}
.sh-save{flex:1;padding:15px;background:var(--acc);color:#fff;border:none;border-radius:12px;font-family:'Syne',sans-serif;font-weight:700;font-size:15px;cursor:pointer}
.sh-save:active{background:#3a66ee}
.sh-cancel{padding:15px 18px;background:transparent;color:var(--mut);border:1px solid var(--brd);border-radius:12px;font-family:'Syne',sans-serif;font-weight:700;font-size:14px;cursor:pointer}

/* MODALS */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:300;align-items:flex-end;justify-content:center;backdrop-filter:blur(4px)}
.overlay.open{display:flex}
@media(min-width:600px){.overlay{align-items:center}}
.modal{background:var(--surf);border:1px solid var(--brd);border-radius:24px 24px 0 0;padding:22px 22px calc(22px + var(--safe-b));width:100%;max-width:440px;display:flex;flex-direction:column;gap:14px;box-shadow:0 -20px 60px rgba(0,0,0,.6);animation:shUp .3s cubic-bezier(.4,0,.2,1)}
@media(min-width:600px){.modal{border-radius:20px;padding:26px;animation:mIn .3s cubic-bezier(.16,1,.3,1)}}
@keyframes shUp{from{transform:translateY(100%)}to{transform:none}}
@keyframes mIn{from{opacity:0;transform:translateY(12px) scale(.97)}to{opacity:1;transform:none}}
.modal h3{font-family:'Syne',sans-serif;font-size:18px;font-weight:800}
.modal label{font-size:11px;color:var(--mut);font-weight:700;display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:.08em}
.modal input,.modal select{width:100%;border:1px solid var(--brd);border-radius:11px;padding:13px 14px;font-size:15px;font-family:'Outfit',sans-serif;outline:none;background:var(--col);color:var(--tx);transition:border .15s;-webkit-appearance:none}
.modal input:focus,.modal select:focus{border-color:var(--acc)}
.m-handle{width:36px;height:4px;background:var(--brd2);border-radius:99px;margin:0 auto -4px}
@media(min-width:600px){.m-handle{display:none}}
.m-btns{display:flex;gap:10px}
.reset-inf{font-size:13px;color:var(--mut);line-height:1.6;background:rgba(255,197,66,.06);border:1px solid rgba(255,197,66,.2);border-radius:12px;padding:13px 15px}
.reset-opts{display:flex;flex-direction:column;gap:9px}
.reset-opt{background:var(--col);border:1px solid var(--brd);border-radius:12px;padding:14px 15px;cursor:pointer;transition:background .15s;text-align:left;width:100%}
.reset-opt:active{background:rgba(255,197,66,.07)}
.ro-t{font-family:'Syne',sans-serif;font-weight:700;color:var(--ylw);font-size:13px}
.ro-d{color:var(--mut);font-size:12px;margin-top:3px}
.btn{display:inline-flex;align-items:center;gap:6px;padding:11px 18px;border-radius:11px;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;cursor:pointer;border:none;transition:all .15s}
.btn:active{transform:scale(.96)}
.btn-acc{background:var(--acc);color:#fff}
.btn-ghost{background:transparent;color:var(--mut);border:1px solid var(--brd)}
.btn-full{width:100%;justify-content:center;padding:13px}

/* LOGIN */
#login-screen{display:flex}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
.sync-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;transition:background .3s}
.sync-dot.ok{background:var(--grn);box-shadow:0 0 6px rgba(34,211,160,.5)}
.sync-dot.saving{background:var(--ylw);animation:spin .8s linear infinite}
.sync-dot.err{background:var(--red)}
@keyframes spin{to{transform:rotate(360deg)}}
@media(min-width:400px){#sync-lbl{display:block!important}}
.side-ov{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:199;display:none;backdrop-filter:blur(3px)}
.side-ov.open{display:block}
.side-menu{position:fixed;top:0;right:-300px;width:280px;height:100%;background:var(--surf);border-left:1px solid var(--brd);z-index:200;transition:right .3s cubic-bezier(.4,0,.2,1);padding:calc(var(--safe-t) + 70px) 14px calc(30px + var(--safe-b));display:flex;flex-direction:column;gap:4px;overflow-y:auto}
.side-menu.open{right:0;box-shadow:-16px 0 48px rgba(0,0,0,.6)}
.menu-item{display:flex;align-items:center;gap:12px;padding:13px 14px;border-radius:11px;font-size:14px;color:var(--mut2);cursor:pointer;border:none;background:transparent;width:100%;text-align:left;transition:background .15s,color .15s}
.menu-item:active{background:var(--col);color:var(--tx)}
.menu-item.danger:active{background:rgba(255,82,99,.1);color:var(--red)}
.menu-sep{height:1px;background:var(--brd);margin:6px 0}
.menu-ttl{font-family:'Syne',sans-serif;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--mut);padding:10px 14px 4px}

/* TOAST */
.toast{
  position:fixed;bottom:calc(var(--nav-h) + var(--safe-b) + 12px);left:50%;
  transform:translateX(-50%) translateY(16px);
  background:#2a2f42;border:1px solid var(--brd2);color:var(--tx);
  padding:12px 22px;border-radius:14px;font-size:13.5px;
  font-family:'Syne',sans-serif;font-weight:700;
  box-shadow:0 8px 32px rgba(0,0,0,.5);z-index:9999;
  opacity:0;transition:opacity .28s,transform .28s;pointer-events:none;
  white-space:nowrap;max-width:88vw;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
@media(min-width:768px){.toast{bottom:24px;right:24px;left:auto;transform:translateY(10px)}.toast.show{transform:translateY(0)}}

/* EMPTY */
.empty-st{text-align:center;padding:48px 20px;color:var(--mut)}
.empty-ico{font-size:44px;margin-bottom:12px;opacity:.35}
.empty-tx{font-size:14px;line-height:1.7}
</style>
</head>
<body>
<div id="login-screen" style="display:none;min-height:100vh;min-height:100dvh;background:var(--bg);align-items:center;justify-content:center;padding:24px;flex-direction:column;gap:0">
  <div id="login-card" style="width:100%;max-width:380px;background:var(--surf);border:1px solid var(--brd);border-radius:24px;overflow:hidden;box-shadow:0 24px 80px rgba(0,0,0,.5)">
    <!-- Header -->
    <div style="background:linear-gradient(135deg,#1a1f30,#0f1117);padding:32px 28px 28px;text-align:center">
      <div style="width:56px;height:56px;background:linear-gradient(135deg,#c8892a,#f0b040);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:26px;margin:0 auto 16px;box-shadow:0 8px 24px rgba(200,137,42,.4)">ğŸ“‹</div>
      <div style="font-family:'Syne',sans-serif;font-size:26px;font-weight:800;color:var(--tx);letter-spacing:-.02em">Vibenith</div>
      <div style="font-size:13px;color:var(--mut);margin-top:6px">Entre ou crie sua conta</div>
    </div>
    <!-- Form -->
    <div style="padding:28px">
      <div id="li-err" style="display:none;background:rgba(255,82,99,.1);border:1px solid rgba(255,82,99,.3);border-radius:10px;padding:10px 14px;font-size:13px;color:var(--red);margin-bottom:16px;font-family:'Syne',sans-serif;font-weight:700;text-align:center"></div>
      <div style="margin-bottom:14px">
        <label style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.09em;color:var(--mut);display:block;margin-bottom:7px">UsuÃ¡rio</label>
        <input id="li-user" type="text" placeholder="ex: artur123" maxlength="30" autocomplete="username" style="width:100%;background:var(--col);border:1px solid var(--brd);border-radius:12px;padding:14px;font-size:15px;font-family:'Outfit',sans-serif;color:var(--tx);outline:none;-webkit-appearance:none;transition:border .15s" onfocus="this.style.borderColor='var(--acc)'" onblur="this.style.borderColor='var(--brd)'" onkeydown="if(event.key==='Enter')document.getElementById('li-pass').focus()">
      </div>
      <div style="margin-bottom:20px">
        <label style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.09em;color:var(--mut);display:block;margin-bottom:7px">Senha</label>
        <input id="li-pass" type="password" placeholder="MÃ­nimo 4 caracteres" maxlength="50" autocomplete="current-password" style="width:100%;background:var(--col);border:1px solid var(--brd);border-radius:12px;padding:14px;font-size:15px;font-family:'Outfit',sans-serif;color:var(--tx);outline:none;-webkit-appearance:none;transition:border .15s" onfocus="this.style.borderColor='var(--acc)'" onblur="this.style.borderColor='var(--brd)'" onkeydown="if(event.key==='Enter')doLogin()">
      </div>
      <button id="li-btn" onclick="doLogin()" style="width:100%;padding:15px;background:var(--acc);color:#fff;border:none;border-radius:12px;font-family:'Syne',sans-serif;font-weight:800;font-size:15px;cursor:pointer;transition:background .15s;letter-spacing:.02em">Entrar / Criar conta</button>
      <div style="font-size:12px;color:var(--mut);text-align:center;margin-top:16px;line-height:1.6">Se o usuÃ¡rio nÃ£o existir, <strong style="color:var(--tx)">uma conta nova Ã© criada</strong> automaticamente.<br>Use o mesmo usuÃ¡rio e senha em todos os dispositivos.</div>
    </div>
  </div>
</div>

<div id="app" style="display:none">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="tb-logo">ğŸ“‹</div>
    <div class="tb-title">Vibenith</div>
    <div style="display:flex;align-items:center;gap:7px">
      <!-- Sync status indicator -->
      <div id="sync-status" style="display:flex;align-items:center;gap:5px;padding:5px 9px;background:var(--col);border:1px solid var(--brd);border-radius:8px;cursor:pointer" onclick="pullFromCloud()" title="Toque para sincronizar">
        <span class="sync-dot ok" id="sync-dot"></span>
        <span id="sync-lbl" style="font-size:10px;font-family:'Syne',sans-serif;font-weight:700;color:var(--mut);white-space:nowrap;display:none"></span>
      </div>
      <div class="tb-desktop-row">
        <span style="font-size:12px;color:var(--mut)" id="board-date"></span>
        <div style="width:1px;height:20px;background:var(--brd)"></div>
        <button class="dsk-btn dsk-ghost" onclick="exportData()"><svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Salvar</button>
        <button class="dsk-btn dsk-ghost" onclick="importData()"><svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>Carregar</button>
        <button class="dsk-btn dsk-warn" onclick="openResetModal()">â†º Redefinir</button>
        <button class="dsk-btn dsk-acc" onclick="openColModal()">+ Nova Coluna</button>
      </div>
      <button class="tb-action menu-only" onclick="toggleMenu()">
        <svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
      <div id="user-badge" style="display:none;font-size:11px;font-family:'Syne',sans-serif;font-weight:700;color:var(--mut2);background:var(--col);border:1px solid var(--brd);border-radius:8px;padding:5px 10px;white-space:nowrap;max-width:100px;overflow:hidden;text-overflow:ellipsis"></div>
    </div>
  </div>

  <!-- DESKTOP TABS -->
  <div class="top-tab-bar">
    <button class="top-tab-btn active" onclick="gotoScreen('tarefas',this)">ğŸ“‹ Tarefas</button>
    <button class="top-tab-btn" onclick="gotoScreen('painel',this)">ğŸ“Š Painel</button>
    <button class="top-tab-btn" onclick="gotoScreen('agua',this)">ğŸ’§ Ãgua</button>
    <button class="top-tab-btn" onclick="gotoScreen('metas',this)">ğŸ¯ Metas</button>
  </div>

  <!-- BODY -->
  <div class="app-body">

    <!-- TAREFAS -->
    <div class="screen active" id="scr-tarefas">
      <!-- Sub-nav (column selector, mobile only) -->
      <div class="kanban-sub-nav" id="ksn"></div>
      <div class="board-container">
        <div class="board" id="board"></div>
      </div>
    </div>

    <!-- PAINEL -->
    <div class="screen" id="scr-painel">
      <div class="screen-hdr">
        <div>
          <div class="screen-hdr-title">Painel</div>
          <div class="screen-hdr-sub" id="board-date2"></div>
        </div>
      </div>
      <div class="scr-scroll" style="padding:0 16px 24px">
        <div class="panel-widget">
          <div class="pw-title">ğŸ“Š EstatÃ­sticas</div>
          <div class="stats-grid">
            <div class="stat-box"><div class="stat-lbl">Total</div><div class="stat-val sv-blue" id="s-total">0</div></div>
            <div class="stat-box"><div class="stat-lbl">A Fazer</div><div class="stat-val sv-yellow" id="s-pend">0</div></div>
            <div class="stat-box"><div class="stat-lbl">Andamento</div><div class="stat-val sv-purple" id="s-prog">0</div></div>
            <div class="stat-box"><div class="stat-lbl">ConcluÃ­das</div><div class="stat-val sv-green" id="s-done">0</div></div>
          </div>
          <div style="display:flex;align-items:center;justify-content:space-between;font-size:12px;color:var(--mut);margin-top:16px;margin-bottom:7px">
            <span>Progresso geral</span>
            <span style="font-family:'Syne',sans-serif;font-weight:700;color:var(--acc)" id="s-pct">0%</span>
          </div>
          <div class="prog-wrap"><div class="prog-fill" id="prog-fill" style="width:0%"></div></div>
        </div>
        <div class="panel-widget">
          <div class="pw-title">ğŸ¥§ DistribuiÃ§Ã£o</div>
          <div class="pie-row">
            <svg id="pie-svg" width="110" height="110" viewBox="0 0 100 100" style="flex-shrink:0"></svg>
            <div class="pie-legend" id="pie-legend"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ÃGUA -->
    <div class="screen" id="scr-agua">
      <div class="screen-hdr">
        <div class="screen-hdr-title">HidrataÃ§Ã£o</div>
        <button class="wa-goal-btn" onclick="editWaterGoal()">âš™ï¸ Meta</button>
      </div>
      <div class="scr-scroll" style="padding:0 16px 100px">
        <div class="panel-widget" style="text-align:center;margin-bottom:12px">
          <div class="water-big"><span id="w-cups">0</span><span class="water-of"> / <span id="w-goal">8</span></span></div>
          <div class="water-ml" id="w-ml">0 ml de 2000 ml</div>
          <div class="w-bar-wrap" style="margin:16px 0 20px"><div class="w-bar-fill" id="water-bar" style="width:0%"></div></div>
          <div class="water-cups" id="water-cups"></div>
        </div>
        <div class="water-acts">
          <button class="wa-btn wa-add" onclick="addWater()">+ Copo</button>
          <button class="wa-btn wa-reset" onclick="resetWater()">Zerar dia</button>
        </div>
      </div>
    </div>

    <!-- METAS -->
    <div class="screen" id="scr-metas">
      <div class="screen-hdr">
        <div>
          <div class="screen-hdr-title">Metas</div>
          <div class="screen-hdr-sub">Clique em âœ• para excluir</div>
        </div>
        <span class="yr-badge" id="goals-yr-badge"></span>
      </div>
      <div class="scr-scroll" style="padding:0 16px 100px">
        <div id="goals-list"></div>
        <div class="add-goal-box">
          <div style="font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:var(--tx)">â• Nova Meta</div>
          <input class="ag-inp" type="text" id="goal-title-inp" placeholder="ex: Ler 12 livros, Academia 3xâ€¦" maxlength="80">
          <select class="ag-inp ag-sel" id="goal-cat-inp">
            <option value="saude">ğŸ’ª SaÃºde</option><option value="carreira">ğŸ’¼ Carreira</option>
            <option value="financas">ğŸ’° FinanÃ§as</option><option value="estudos">ğŸ“š Estudos</option>
            <option value="pessoal">ğŸŒ± Pessoal</option><option value="viagem">âœˆï¸ Viagem</option>
            <option value="outro">â­ Outro</option>
          </select>
          <button class="ag-save" onclick="addGoal()">Adicionar Meta</button>
        </div>
      </div>
    </div>

  </div><!-- /app-body -->

  <!-- BOTTOM NAV -->
  <nav class="bottom-nav">
    <button class="nav-item active" id="ni-tarefas" onclick="gotoScreen('tarefas',this)">
      <div class="nav-ico-wrap">
        <div class="nav-icon">ğŸ“‹</div>
        <span class="nav-badge" id="nb-tarefas"></span>
      </div>
      <span class="nav-lbl">Tarefas</span>
    </button>
    <button class="nav-item" id="ni-painel" onclick="gotoScreen('painel',this)">
      <div class="nav-ico-wrap">
        <div class="nav-icon">ğŸ“Š</div>
      </div>
      <span class="nav-lbl">Painel</span>
    </button>
    <button class="nav-item" id="ni-agua" onclick="gotoScreen('agua',this)">
      <div class="nav-ico-wrap">
        <div class="nav-icon">ğŸ’§</div>
      </div>
      <span class="nav-lbl">Ãgua</span>
    </button>
    <button class="nav-item" id="ni-metas" onclick="gotoScreen('metas',this)">
      <div class="nav-ico-wrap">
        <div class="nav-icon">ğŸ¯</div>
      </div>
      <span class="nav-lbl">Metas</span>
    </button>
  </nav>

  <!-- FAB -->
  <button class="fab" id="fab" onclick="openSheet()">
    <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
  </button>

  <!-- SIDE MENU -->
  <div class="side-ov" id="side-ov" onclick="closeMenu()"></div>
  <div class="side-menu" id="side-menu">
    <div class="menu-ttl">Ferramentas</div>
    <button class="menu-item" onclick="pullFromCloud();closeMenu()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>Sincronizar agora</button>
    <div class="menu-sep"></div>
    <button class="menu-item" onclick="exportData();closeMenu()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Salvar backup</button>
    <button class="menu-item" onclick="importData();closeMenu()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>Carregar backup</button>
    <button class="menu-item" onclick="openColModal();closeMenu()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Nova coluna</button>
    <div class="menu-sep"></div>
    <button class="menu-item" onclick="openResetModal();closeMenu()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="3 10 3 3 10 3"/><path d="M21 13a9 9 0 1 0-1.636 5.254"/></svg>Redefinir tarefas</button>
    <div class="menu-sep"></div>
    <div id="menu-user" style="padding:8px 14px;font-size:12px;color:var(--mut);font-family:'Syne',sans-serif;font-weight:700"></div>
    <button class="menu-item danger" onclick="logout()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>Sair da conta</button>
  </div>

  <!-- BOTTOM SHEET (add card mobile) -->
  <div class="sheet-ov" id="sheet-ov" onclick="closeSheet()"></div>
  <div class="bottom-sheet" id="add-sheet">
    <div class="sh-handle"></div>
    <div class="sh-title">Nova Tarefa</div>
    <div class="sh-field"><label class="sh-lbl">TÃ­tulo *</label><input class="sh-inp" type="text" id="sh-title" placeholder="O que precisa ser feito?" maxlength="80"></div>
    <div class="sh-field"><label class="sh-lbl">DescriÃ§Ã£o</label><textarea class="sh-inp" id="sh-desc" rows="2" placeholder="Detalhes (opcional)"></textarea></div>
    <div class="sh-field"><label class="sh-lbl">Coluna</label><select class="sh-inp sh-sel" id="sh-col"></select></div>
    <div class="sh-field"><label class="sh-lbl">Data</label><input class="sh-inp" type="date" id="sh-date" style="color-scheme:dark"></div>
    <div class="sh-acts">
      <button class="sh-save" onclick="addCardFromSheet()">+ Adicionar</button>
      <button class="sh-cancel" onclick="closeSheet()">Cancelar</button>
    </div>
  </div>

  <!-- MODALS -->
  <div class="overlay" id="tag-overlay">
    <div class="modal"><div class="m-handle"></div><h3>ğŸ·ï¸ Nova Etiqueta</h3>
      <div><label>Nome</label><input type="text" id="tag-name-input" placeholder="ex: Urgenteâ€¦" maxlength="20"></div>
      <div><label>Cor</label><select id="tag-color-input"><option value="blue">ğŸ”µ Azul</option><option value="green">ğŸŸ¢ Verde</option><option value="yellow">ğŸŸ¡ Amarelo</option><option value="red">ğŸ”´ Vermelho</option><option value="purple">ğŸŸ£ Roxo</option><option value="gray">âš« Cinza</option></select></div>
      <div class="m-btns"><button class="btn btn-acc" style="flex:1" onclick="confirmAddTag()">Adicionar</button><button class="btn btn-ghost" onclick="closeTagModal()">Cancelar</button></div>
    </div>
  </div>
  <div class="overlay" id="col-overlay">
    <div class="modal"><div class="m-handle"></div><h3>â• Nova Coluna</h3>
      <div><label>Nome</label><input type="text" id="col-name-input" placeholder="ex: Em revisÃ£oâ€¦" maxlength="30"></div>
      <div><label>Cor</label><select id="col-color-input"><option value="#4f7bff">ğŸ”µ Azul</option><option value="#22d3a0">ğŸŸ¢ Verde</option><option value="#ffc542">ğŸŸ¡ Amarelo</option><option value="#ff5263">ğŸ”´ Vermelho</option><option value="#a78bfa">ğŸŸ£ Roxo</option><option value="#6b7294">âš« Cinza</option></select></div>
      <div class="m-btns"><button class="btn btn-acc" style="flex:1" onclick="confirmAddCol()">Criar</button><button class="btn btn-ghost" onclick="closeColModal()">Cancelar</button></div>
    </div>
  </div>
  <div class="overlay" id="reset-overlay">
    <div class="modal"><div class="m-handle"></div><h3>â†º Redefinir</h3>
      <div class="reset-inf">As <strong style="color:var(--ylw)">Metas nÃ£o serÃ£o afetadas</strong>.</div>
      <div class="reset-opts">
        <button class="reset-opt" onclick="resetDoneTasks()"><div class="ro-t">âœ… Desmarcar concluÃ­das</div><div class="ro-d">Reabre todas, mantendo conteÃºdo</div></button>
        <button class="reset-opt" onclick="resetAllCards()"><div class="ro-t">ğŸ—‘ Apagar todas as tarefas</div><div class="ro-d">Remove cartÃµes, mantÃ©m colunas</div></button>
        <button class="reset-opt" onclick="resetToDefault()"><div class="ro-t">ğŸ”„ Restaurar padrÃ£o</div><div class="ro-d">Volta ao estado inicial</div></button>
      </div>
      <button class="btn btn-ghost btn-full" onclick="closeResetModal()">Cancelar</button>
    </div>
  </div>

</div><!-- /app -->
<div class="toast" id="toast"></div>

<script>
const COL_TODO='col1',COL_PROGRESS='col2',COL_DONE='col3';

// â”€â”€â”€ SUPABASE CONFIG â”€â”€â”€
const SB_URL='https://ybyrlxijeoitdofbifhb.supabase.co';
const SB_KEY='sb_publishable_LCrwdnZiUsrUevaMa2pE3A_nyvPQsBL';
let syncTimer=null,syncing=false,lastSyncedAt=null;
let currentUser=null; // logged in username

function sbHeaders(){return{'Content-Type':'application/json','apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY};}

// Simple hash (not cryptographic, but enough for this use case)
async function hashPassword(pw){
  const buf=await crypto.subtle.digest('SHA-256',new TextEncoder().encode(pw));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

// â”€â”€â”€ AUTH â”€â”€â”€
async function doLogin(){
  const u=document.getElementById('li-user').value.trim().toLowerCase();
  const p=document.getElementById('li-pass').value;
  if(!u||!p){shakeLogin('Preencha usuÃ¡rio e senha');return;}
  setLoginLoading(true);
  try{
    const hash=await hashPassword(p);
    // Check if user exists
    const r=await fetch(`${SB_URL}/rest/v1/users?username=eq.${encodeURIComponent(u)}&select=username,password_hash`,{headers:sbHeaders()});
    const rows=await r.json();
    if(rows.length===0){
      // New user â€” create account
      const cr=await fetch(`${SB_URL}/rest/v1/users`,{method:'POST',headers:{...sbHeaders(),'Prefer':'return=minimal'},body:JSON.stringify({username:u,password_hash:hash})});
      if(!cr.ok){shakeLogin('Erro ao criar conta. Tente novamente.');setLoginLoading(false);return;}
      currentUser=u;
      localStorage.setItem('vibenith_user',u);
      enterApp(true);
    } else {
      // Existing user â€” check password
      if(rows[0].password_hash!==hash){shakeLogin('Senha incorreta');setLoginLoading(false);return;}
      currentUser=u;
      localStorage.setItem('vibenith_user',u);
      enterApp(false);
    }
  }catch(e){shakeLogin('Sem conexÃ£o. Tente novamente.');setLoginLoading(false);}
}

function shakeLogin(msg){
  const err=document.getElementById('li-err');err.textContent=msg;err.style.display='block';
  const card=document.getElementById('login-card');card.style.animation='none';
  requestAnimationFrame(()=>{card.style.animation='shake .4s';});
  setLoginLoading(false);
}
function setLoginLoading(on){
  const btn=document.getElementById('li-btn');
  btn.disabled=on;btn.textContent=on?'Entrandoâ€¦':'Entrar / Criar conta';
}

function enterApp(isNew){
  document.getElementById('login-screen').style.display='none';
  document.getElementById('app').style.display='flex';
  const ub=document.getElementById('user-badge');if(ub){ub.textContent='ğŸ‘¤ '+currentUser;ub.style.display='block';}
  const mu=document.getElementById('menu-user');if(mu)mu.textContent='Logado como '+currentUser;
  initApp(isNew);
}

function logout(){
  // Stop all timers
  Object.keys(timers).forEach(id=>stopTimerInterval(id));
  currentUser=null;
  localStorage.removeItem('vibenith_user');
  state=JSON.parse(JSON.stringify(DS));goals=[];
  closeMenu();
  document.getElementById('app').style.display='none';
  document.getElementById('login-screen').style.display='flex';
  document.getElementById('li-user').value='';
  document.getElementById('li-pass').value='';
  document.getElementById('li-err').style.display='none';
  setLoginLoading(false);
}

// â”€â”€â”€ CLOUD SYNC (per user) â”€â”€â”€
function userRow(){return 'u_'+currentUser;}

async function pushToCloud(silent){
  if(!currentUser||syncing)return;syncing=true;setSyncStatus('saving');
  try{
    const row=userRow();
    const payload={id:row,data:{state,goals},updated_at:new Date().toISOString()};
    // Try PATCH first, then POST if not found
    const pr=await fetch(`${SB_URL}/rest/v1/sync_data?id=eq.${row}`,{method:'PATCH',headers:{...sbHeaders(),'Prefer':'return=minimal'},body:JSON.stringify(payload)});
    if(pr.status===404||pr.headers.get('content-range')==='*/0'){
      await fetch(`${SB_URL}/rest/v1/sync_data`,{method:'POST',headers:{...sbHeaders(),'Prefer':'return=minimal'},body:JSON.stringify(payload)});
    }
    lastSyncedAt=new Date();setSyncStatus('ok');
    if(!silent)showToast('â˜ï¸ Sincronizado!');
  }catch(e){setSyncStatus('err');if(!silent)showToast('âš ï¸ Erro ao sincronizar');}
  finally{syncing=false;}
}

async function pullFromCloud(){
  if(!currentUser)return;
  setSyncStatus('saving');
  try{
    const row=userRow();
    const r=await fetch(`${SB_URL}/rest/v1/sync_data?id=eq.${row}&select=data,updated_at`,{headers:sbHeaders()});
    if(!r.ok)throw new Error(r.status);
    const rows=await r.json();
    if(rows.length&&rows[0].data&&Object.keys(rows[0].data).length){
      const d=rows[0].data;
      if(d.state)state=d.state;
      if(d.goals)goals=d.goals;
      ensureFixedCols();
      state.columns.forEach(col=>col.cards.forEach(c=>{if(!c.status)c.status='todo';if(!c.elapsed)c.elapsed=0;}));
      localStorage.setItem('vibenith_v1_'+currentUser,JSON.stringify(state));
      localStorage.setItem('vibenith_goals_'+currentUser,JSON.stringify(goals));
      renderAll();renderGoals();
      lastSyncedAt=new Date();setSyncStatus('ok');
      showToast('â˜ï¸ Dados atualizados!');
    }else{
      await pushToCloud(true);
    }
  }catch(e){setSyncStatus('err');showToast('âš ï¸ Sem conexÃ£o com nuvem');}
}

function schedulePush(){clearTimeout(syncTimer);syncTimer=setTimeout(()=>pushToCloud(true),2000);}

function setSyncStatus(s){
  const el=document.getElementById('sync-dot');if(!el)return;
  el.className='sync-dot '+s;
  const lbl=document.getElementById('sync-lbl');if(!lbl)return;
  if(s==='saving')lbl.textContent='Sincronizandoâ€¦';
  else if(s==='ok'){const t=lastSyncedAt?lastSyncedAt.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'}):'';lbl.textContent='Sincronizado'+(t?' Ã s '+t:'');}
  else lbl.textContent='Sem conexÃ£o';
}

const DS={columns:[
  {id:'col1',title:'Tarefas',color:'#ffc542',locked:true,cards:[
    {id:'c1',title:'Criar apresentaÃ§Ã£o do projeto',desc:'Slides para reuniÃ£o na sexta.',tags:[{name:'Urgente',color:'red'}],date:'',status:'todo',elapsed:0},
    {id:'c2',title:'Revisar relatÃ³rio mensal',desc:'Conferir os nÃºmeros de marÃ§o.',tags:[{name:'RelatÃ³rio',color:'blue'}],date:'',status:'todo',elapsed:0}
  ]},
  {id:'col2',title:'Em Andamento',color:'#4f7bff',locked:true,cards:[
    {id:'c3',title:'Atualizar site institucional',desc:'Trocar fotos da pÃ¡gina Sobre nÃ³s.',tags:[{name:'Design',color:'purple'}],date:'',status:'progress',elapsed:0}
  ]},
  {id:'col3',title:'ConcluÃ­do',color:'#22d3a0',locked:true,cards:[]}
],water:{cups:0,goal:8}};

let state=JSON.parse(JSON.stringify(DS));
let goals=[],tagCid=null,tagColId=null,dragCard=null;
let cCnt=200,colCnt=20,gCnt=100;
let activeColIdx=0; // which column is shown on mobile
const timers={};

const CAT={saude:{label:'ğŸ’ª SaÃºde',bg:'rgba(34,211,160,.13)',c:'var(--grn)',b:'rgba(34,211,160,.27)'},carreira:{label:'ğŸ’¼ Carreira',bg:'rgba(79,123,255,.13)',c:'var(--acc)',b:'rgba(79,123,255,.27)'},financas:{label:'ğŸ’° FinanÃ§as',bg:'rgba(255,197,66,.13)',c:'var(--ylw)',b:'rgba(255,197,66,.27)'},estudos:{label:'ğŸ“š Estudos',bg:'rgba(167,139,250,.13)',c:'var(--pur)',b:'rgba(167,139,250,.27)'},pessoal:{label:'ğŸŒ± Pessoal',bg:'rgba(34,211,238,.13)',c:'var(--cyn)',b:'rgba(34,211,238,.27)'},viagem:{label:'âœˆï¸ Viagem',bg:'rgba(255,82,99,.13)',c:'var(--red)',b:'rgba(255,82,99,.27)'},outro:{label:'â­ Outro',bg:'rgba(255,255,255,.07)',c:'var(--mut)',b:'var(--brd)'}};

// â”€â”€â”€ INIT â”€â”€â”€
function initApp(isNew){
  if(!isNew){
    const sv=localStorage.getItem('vibenith_v1_'+currentUser);if(sv){try{state=JSON.parse(sv);}catch(e){}}
    const sg=localStorage.getItem('vibenith_goals_'+currentUser);if(sg){try{goals=JSON.parse(sg);}catch(e){}}
  } else {
    state=JSON.parse(JSON.stringify(DS));goals=[];
  }
  ensureFixedCols();
  state.columns.forEach(col=>col.cards.forEach(c=>{if(!c.status)c.status='todo';if(!c.elapsed)c.elapsed=0;}));
  const d=new Date().toLocaleDateString('pt-BR',{weekday:'long',day:'numeric',month:'long'});
  const bd=document.getElementById('board-date');if(bd)bd.textContent=d;
  const bd2=document.getElementById('board-date2');if(bd2)bd2.textContent=d;
  document.getElementById('goals-yr-badge').textContent=new Date().getFullYear();
  renderAll();renderGoals();
  pullFromCloud();
}

function autoLogin(){
  const saved=localStorage.getItem('vibenith_user');
  if(saved){
    currentUser=saved;
    const ub=document.getElementById('user-badge');if(ub)ub.textContent='ğŸ‘¤ '+currentUser;
    document.getElementById('login-screen').style.display='none';
    document.getElementById('app').style.display='flex';
    initApp(false);
  } else {
    document.getElementById('login-screen').style.display='flex';
    document.getElementById('app').style.display='none';
  }
}
function ensureFixedCols(){
  const ids=state.columns.map(c=>c.id);
  if(!ids.includes('col1'))state.columns.unshift({id:'col1',title:'Tarefas',color:'#ffc542',locked:true,cards:[]});
  if(!ids.includes('col2')){const i=state.columns.findIndex(c=>c.id==='col1');state.columns.splice(i+1,0,{id:'col2',title:'Em Andamento',color:'#4f7bff',locked:true,cards:[]});}
  if(!ids.includes('col3'))state.columns.push({id:'col3',title:'ConcluÃ­do',color:'#22d3a0',locked:true,cards:[]});
  state.columns.forEach(c=>{if(['col1','col2','col3'].includes(c.id))c.locked=true;});
}
function save(){if(currentUser)localStorage.setItem('vibenith_v1_'+currentUser,JSON.stringify(state));updateStats();schedulePush();}
function saveGoals(){if(currentUser)localStorage.setItem('vibenith_goals_'+currentUser,JSON.stringify(goals));schedulePush();}

// â”€â”€â”€ NAVIGATION â”€â”€â”€
let curScreen='tarefas';
function gotoScreen(id, btn){
  curScreen=id;
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('scr-'+id).classList.add('active');
  // bottom nav
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  const ni=document.getElementById('ni-'+id);if(ni)ni.classList.add('active');
  // top tabs (desktop)
  document.querySelectorAll('.top-tab-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  // fab visibility
  const fab=document.getElementById('fab');if(fab)fab.style.display=id==='tarefas'?'flex':'none';
}
function toggleMenu(){document.getElementById('side-menu').classList.toggle('open');document.getElementById('side-ov').classList.toggle('open');}
function closeMenu(){document.getElementById('side-menu').classList.remove('open');document.getElementById('side-ov').classList.remove('open');}

// â”€â”€â”€ KANBAN SUB-NAV (mobile column switcher) â”€â”€â”€
function renderSubNav(){
  const ksn=document.getElementById('ksn');ksn.innerHTML='';
  state.columns.forEach((col,i)=>{
    const btn=document.createElement('button');
    btn.className='ksn-btn'+(i===activeColIdx?' active':'');
    btn.innerHTML=`<span class="ksn-dot" style="background:${col.color}"></span>${col.title}<span class="ksn-cnt">${col.cards.length}</span>`;
    btn.onclick=()=>showColumn(i);
    ksn.appendChild(btn);
  });
}
function showColumn(idx){
  activeColIdx=idx;
  const board=document.getElementById('board');
  board.style.transform=`translateX(-${idx*100}%)`;
  renderSubNav();
}

// â”€â”€â”€ RENDER â”€â”€â”€
function renderAll(){
  const board=document.getElementById('board');board.innerHTML='';
  state.columns.forEach(col=>board.appendChild(buildCol(col)));
  // Desktop: add col button
  const acw=document.createElement('div');acw.className='add-col-wrap';
  const acb=document.createElement('button');acb.className='add-col-btn';acb.onclick=openColModal;
  acb.innerHTML=`<svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Nova Coluna`;
  acw.appendChild(acb);board.appendChild(acw);
  // Sheet col selector
  const sel=document.getElementById('sh-col');
  if(sel)sel.innerHTML=state.columns.map(c=>`<option value="${c.id}">${esc(c.title)}</option>`).join('');
  renderSubNav();
  showColumn(Math.min(activeColIdx,state.columns.length-1));
  updateStats();renderWater();
}

function buildCol(col){
  const el=document.createElement('div');
  el.className='k-col';el.id='col-'+col.id;el.dataset.colId=col.id;
  const list=document.createElement('div');list.className='cards-list';list.id='list-'+col.id;
  col.cards.forEach(c=>list.appendChild(buildCard(c,col.id)));
  setupDrop(el,list,col.id);
  const delBtn=col.locked?'':`<button class="k-col-del" onclick="deleteCol('${col.id}')"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M9 6V4h6v2"/></svg></button>`;
  const hd=document.createElement('div');hd.className='k-col-head';
  hd.innerHTML=`<div class="k-col-dot" style="background:${col.color}"></div><input class="k-col-name" value="${esc(col.title)}" onchange="renameCol('${col.id}',this.value)" onblur="save()" ${col.locked?'readonly':''}><span class="k-col-cnt" id="cnt-${col.id}">${col.cards.length}</span>${delBtn}`;
  el.appendChild(hd);el.appendChild(list);
  if(col.id!==COL_DONE){
    const aa=document.createElement('div');aa.className='add-card-area';
    aa.innerHTML=`<div class="add-form" id="af-${col.id}"><input class="af-inp" type="text" placeholder="TÃ­tulo *" id="fi-t-${col.id}" maxlength="80"><textarea class="af-inp" rows="2" placeholder="DescriÃ§Ã£o (opcional)" id="fi-d-${col.id}"></textarea><input class="af-inp" type="date" id="fi-dt-${col.id}" style="color-scheme:dark"><div class="af-btns"><button class="af-save" onclick="addCard('${col.id}')">+ Adicionar</button><button class="af-cancel" onclick="closeForm('${col.id}')">âœ•</button></div></div><button class="open-add-btn" id="oab-${col.id}" onclick="openForm('${col.id}')"><svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Adicionar tarefa</button>`;
    el.appendChild(aa);
  }
  return el;
}

function buildCard(card,colId){
  const el=document.createElement('div');
  const st=card.status||'todo';
  el.className=`card s-${st}`;el.id='card-'+card.id;
  const tags=card.tags.map(t=>`<span class="tag ${t.color}">${esc(t.name)}<span class="tdel" onclick="removeTag('${colId}','${card.id}','${esc(t.name)}')">Ã—</span></span>`).join('');
  let btns='';
  if(st==='todo'){btns=`<button class="sb sb-prog" onclick="setStatus('${colId}','${card.id}','progress')"><svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>Em andamento</button><button class="sb sb-done" onclick="setStatus('${colId}','${card.id}','done')"><svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>ConcluÃ­do</button>`;}
  else if(st==='progress'){btns=`<button class="sb sb-prog on" disabled><svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>Em andamento</button><button class="sb sb-done" onclick="setStatus('${colId}','${card.id}','done')"><svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>ConcluÃ­do</button>`;}
  else{btns=`<button class="sb sb-done on" style="grid-column:span 2" disabled><svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>ConcluÃ­do âœ“</button>`;}
  const timerHtml=st==='progress'?buildTimerHtml(card):'';
  el.innerHTML=`
    <div class="card-accent"></div>
    <div class="card-top">
      <textarea class="card-title" rows="1" oninput="ar(this)" onchange="uf('${colId}','${card.id}','title',this.value)" onblur="save()">${esc(card.title)}</textarea>
      <button class="card-del" onclick="delCard('${colId}','${card.id}')"><svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    </div>
    <textarea class="card-desc" rows="1" placeholder="DescriÃ§Ã£oâ€¦" oninput="ar(this)" onchange="uf('${colId}','${card.id}','desc',this.value)" onblur="save()">${esc(card.desc)}</textarea>
    <div class="tags-row">${tags}<button class="add-tag-btn" onclick="openTagModal('${colId}','${card.id}')">+ tag</button></div>
    <input class="card-date" type="date" value="${card.date||''}" onchange="uf('${colId}','${card.id}','date',this.value);save()">
    ${timerHtml}
    <div class="status-row${st==='todo'||st==='progress'?'':' one'}">${btns}</div>
    ${st==='done'?`<button class="sb sb-undo" onclick="setStatus('${colId}','${card.id}','todo')"><svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="3 10 3 3 10 3"/><path d="M21 13a9 9 0 1 0-1.636 5.254"/></svg>Desfazer</button>`:''}
  `;
  if(st==='progress'){if(timers[card.id]?.running)startTimerInterval(card.id);updateTimerDisplay(card.id);}
  return el;
}

// â”€â”€â”€ TIMER â”€â”€â”€
function buildTimerHtml(card){
  return `<div class="timer-box" id="timer-${card.id}">
    <div class="timer-display" id="tdisp-${card.id}">${fmtTime(card.elapsed||0)}</div>
    <div class="timer-btns">
      <button class="timer-btn t-play" onclick="toggleTimer('${card.id}')">
        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" id="tplay-ico-${card.id}"><polygon points="5,3 19,12 5,21"/></svg>
      </button>
      <button class="timer-btn t-reset" onclick="resetTimer('${card.id}')">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.2" viewBox="0 0 24 24"><polyline points="3 10 3 3 10 3"/><path d="M21 13a9 9 0 1 0-1.636 5.254"/></svg>
      </button>
    </div>
  </div>`;
}
function fmtTime(s){const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=s%60;return`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;}
function toggleTimer(id){if(!timers[id])timers[id]={running:false};timers[id].running?stopTimerInterval(id):startTimerInterval(id);updateTimerDisplay(id);}
function startTimerInterval(id){
  if(!timers[id])timers[id]={running:false};
  if(timers[id].interval)clearInterval(timers[id].interval);
  timers[id].running=true;
  timers[id].interval=setInterval(()=>{const c=findCard(id);if(!c)return;c.elapsed=(c.elapsed||0)+1;updateTimerDisplay(id);if(c.elapsed%10===0)save();},1000);
  const ico=document.getElementById('tplay-ico-'+id);if(ico)ico.innerHTML=`<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>`;
  const box=document.getElementById('timer-'+id);if(box)box.classList.add('timer-running');
}
function stopTimerInterval(id){
  if(timers[id]){clearInterval(timers[id].interval);timers[id].running=false;}
  const ico=document.getElementById('tplay-ico-'+id);if(ico)ico.innerHTML=`<polygon points="5,3 19,12 5,21"/>`;
  const box=document.getElementById('timer-'+id);if(box)box.classList.remove('timer-running');
  save();
}
function resetTimer(id){stopTimerInterval(id);const c=findCard(id);if(c)c.elapsed=0;updateTimerDisplay(id);save();}
function updateTimerDisplay(id){const d=document.getElementById('tdisp-'+id);const c=findCard(id);if(d&&c)d.textContent=fmtTime(c.elapsed||0);}
function findCard(id){for(const col of state.columns){const c=col.cards.find(c=>c.id===id);if(c)return c;}return null;}

// â”€â”€â”€ STATUS + AUTO MOVE â”€â”€â”€
function setStatus(colId,cardId,ns){
  if(ns!=='progress'&&timers[cardId]?.running)stopTimerInterval(cardId);
  const srcCol=state.columns.find(c=>c.id===colId);
  const card=srcCol?.cards.find(c=>c.id===cardId);if(!card)return;
  const tgtColId=ns==='progress'?COL_PROGRESS:ns==='done'?COL_DONE:COL_TODO;
  card.status=ns;
  const el=document.getElementById('card-'+cardId);
  if(el){el.style.transition='opacity .22s,transform .22s';el.style.opacity='0';el.style.transform='translateX(16px)';}
  setTimeout(()=>{
    srcCol.cards=srcCol.cards.filter(c=>c.id!==cardId);
    const tgt=state.columns.find(c=>c.id===tgtColId);
    if(tgt){ns==='done'?tgt.cards.push(card):tgt.cards.unshift(card);}
    rerCol(colId);if(tgtColId!==colId)rerCol(tgtColId);
    renderSubNav();
    // Auto-switch to target column on mobile
    const tIdx=state.columns.findIndex(c=>c.id===tgtColId);
    if(tIdx>=0)showColumn(tIdx);
    save();
    showToast({todo:'â†©ï¸ Voltou para Tarefas!',progress:'â³ Em andamento!',done:'âœ… ConcluÃ­da!'}[ns]);
  },230);
}
function setupDrop(colEl,listEl,colId){
  colEl.addEventListener('dragover',e=>{e.preventDefault();listEl.classList.add('drag-over');});
  colEl.addEventListener('dragleave',e=>{if(!colEl.contains(e.relatedTarget))listEl.classList.remove('drag-over');});
  colEl.addEventListener('drop',e=>{e.preventDefault();listEl.classList.remove('drag-over');if(!dragCard)return;const{cardId,fromColId}=dragCard;if(fromColId===colId)return;const ns=colId===COL_PROGRESS?'progress':colId===COL_DONE?'done':'todo';setStatus(fromColId,cardId,ns);});
}
function rerCol(colId){const col=state.columns.find(c=>c.id===colId);if(!col)return;const ex=document.getElementById('col-'+colId);if(!ex)return;ex.replaceWith(buildCol(col));const cnt=document.getElementById('cnt-'+colId);if(cnt)cnt.textContent=col.cards.length;updateStats();}
function uf(colId,cardId,f,v){const col=state.columns.find(c=>c.id===colId);const card=col?.cards.find(c=>c.id===cardId);if(card)card[f]=v;}
function renameCol(colId,v){const col=state.columns.find(c=>c.id===colId);if(col&&!col.locked)col.title=v;}
function delCard(colId,cardId){
  if(!confirm('Excluir este cartÃ£o?'))return;
  stopTimerInterval(cardId);delete timers[cardId];
  const col=state.columns.find(c=>c.id===colId);col.cards=col.cards.filter(c=>c.id!==cardId);
  const el=document.getElementById('card-'+cardId);
  if(el){el.style.cssText='opacity:0;transform:scale(.9);transition:.2s';setTimeout(()=>{el.remove();const cnt=document.getElementById('cnt-'+colId);if(cnt)cnt.textContent=col.cards.length;save();renderSubNav();},200);}else{save();renderSubNav();}
  showToast('ğŸ—‘ CartÃ£o excluÃ­do');
}
function deleteCol(colId){const col=state.columns.find(c=>c.id===colId);if(col?.locked){showToast('âš ï¸ Coluna fixa');return;}if(!confirm(`Excluir "${col.title}"?`))return;state.columns=state.columns.filter(c=>c.id!==colId);renderAll();save();}
function openForm(colId){document.getElementById('af-'+colId).classList.add('open');document.getElementById('oab-'+colId).style.display='none';document.getElementById('fi-t-'+colId).focus();}
function closeForm(colId){document.getElementById('af-'+colId).classList.remove('open');document.getElementById('oab-'+colId).style.display='';['fi-t-','fi-d-','fi-dt-'].forEach(p=>{const el=document.getElementById(p+colId);if(el)el.value=''});}
function addCard(colId){
  const tEl=document.getElementById('fi-t-'+colId);const title=tEl.value.trim();
  if(!title){tEl.focus();tEl.style.borderColor='var(--red)';setTimeout(()=>tEl.style.borderColor='',1200);return;}
  const status=colId===COL_PROGRESS?'progress':colId===COL_DONE?'done':'todo';
  const card={id:'c'+(++cCnt),title,desc:document.getElementById('fi-d-'+colId).value.trim(),tags:[],date:document.getElementById('fi-dt-'+colId).value,status,elapsed:0};
  const col=state.columns.find(c=>c.id===colId);col.cards.unshift(card);
  const list=document.getElementById('list-'+colId);
  const el=buildCard(card,colId);el.style.cssText='opacity:0;transform:translateY(-8px);transition:.25s';
  list.prepend(el);requestAnimationFrame(()=>{el.style.opacity='1';el.style.transform='';});
  const cnt=document.getElementById('cnt-'+colId);if(cnt)cnt.textContent=col.cards.length;
  closeForm(colId);renderSubNav();save();showToast('ğŸ“ Tarefa adicionada!');
}
function openTagModal(colId,cardId){tagColId=colId;tagCid=cardId;document.getElementById('tag-name-input').value='';document.getElementById('tag-overlay').classList.add('open');setTimeout(()=>document.getElementById('tag-name-input').focus(),300);}
function closeTagModal(){document.getElementById('tag-overlay').classList.remove('open');}
function confirmAddTag(){const name=document.getElementById('tag-name-input').value.trim();const color=document.getElementById('tag-color-input').value;if(!name)return;const col=state.columns.find(c=>c.id===tagColId);const card=col.cards.find(c=>c.id===tagCid);if(!card.tags.find(t=>t.name===name))card.tags.push({name,color});closeTagModal();document.getElementById('card-'+tagCid).replaceWith(buildCard(card,tagColId));save();}
function removeTag(colId,cardId,tagName){const col=state.columns.find(c=>c.id===colId);const card=col.cards.find(c=>c.id===cardId);card.tags=card.tags.filter(t=>t.name!==tagName);document.getElementById('card-'+cardId).replaceWith(buildCard(card,colId));save();}
function openColModal(){document.getElementById('col-name-input').value='';document.getElementById('col-overlay').classList.add('open');setTimeout(()=>document.getElementById('col-name-input').focus(),300);}
function closeColModal(){document.getElementById('col-overlay').classList.remove('open');}
function confirmAddCol(){const name=document.getElementById('col-name-input').value.trim();const color=document.getElementById('col-color-input').value;if(!name)return;state.columns.push({id:'col'+(++colCnt),title:name,color,locked:false,cards:[]});closeColModal();renderAll();save();}
function openSheet(){document.getElementById('add-sheet').classList.add('open');document.getElementById('sheet-ov').classList.add('open');// Pre-select current column
const sel=document.getElementById('sh-col');if(sel&&state.columns[activeColIdx])sel.value=state.columns[activeColIdx].id;setTimeout(()=>document.getElementById('sh-title').focus(),300);}
function closeSheet(){document.getElementById('add-sheet').classList.remove('open');document.getElementById('sheet-ov').classList.remove('open');['sh-title','sh-desc','sh-date'].forEach(id=>{const el=document.getElementById(id);if(el)el.value=''});}
function addCardFromSheet(){const tEl=document.getElementById('sh-title');const title=tEl.value.trim();if(!title){tEl.focus();tEl.style.borderColor='var(--red)';setTimeout(()=>tEl.style.borderColor='',1200);return;}const colId=document.getElementById('sh-col').value||state.columns[0]?.id;if(!colId)return;const status=colId===COL_PROGRESS?'progress':colId===COL_DONE?'done':'todo';const card={id:'c'+(++cCnt),title,desc:document.getElementById('sh-desc').value.trim(),tags:[],date:document.getElementById('sh-date').value,status,elapsed:0};const col=state.columns.find(c=>c.id===colId);col.cards.unshift(card);closeSheet();rerCol(colId);renderSubNav();save();showToast('ğŸ“ Tarefa adicionada!');}

// â”€â”€â”€ STATS â”€â”€â”€
function updateStats(){
  let total=0,done=0,prog=0;
  state.columns.forEach(col=>{total+=col.cards.length;done+=col.cards.filter(c=>c.status==='done').length;prog+=col.cards.filter(c=>c.status==='progress').length;});
  const pct=total===0?0:Math.round(done/total*100);
  [['s-total',total],['s-pend',Math.max(0,total-done-prog)],['s-prog',prog],['s-done',done],['s-pct',pct+'%']].forEach(([id,v])=>{const el=document.getElementById(id);if(el)el.textContent=v;});
  const pf=document.getElementById('prog-fill');if(pf)pf.style.width=pct+'%';
  // Badge on tarefas nav
  const nb=document.getElementById('nb-tarefas');
  const todo=state.columns.find(c=>c.id===COL_TODO)?.cards.length||0;
  if(nb){nb.textContent=todo;nb.classList.toggle('show',todo>0);}
  renderPie();
}
function renderPie(){
  const svg=document.getElementById('pie-svg'),leg=document.getElementById('pie-legend');if(!svg||!leg)return;
  svg.innerHTML='';leg.innerHTML='';
  const cd=state.columns.map(col=>({label:col.title,count:col.cards.length,color:col.color})).filter(d=>d.count>0);
  const total=cd.reduce((s,d)=>s+d.count,0);
  if(total===0){svg.innerHTML=`<circle cx="50" cy="50" r="36" fill="none" stroke="#283048" stroke-width="14"/><text x="50" y="55" text-anchor="middle" font-size="9" fill="#5a6280" font-family="Syne">Vazio</text>`;leg.innerHTML=`<div style="color:var(--mut);font-size:12px">Sem tarefas</div>`;return;}
  const cx=50,cy=50,r=36,sw=14,circ=2*Math.PI*r;let off=0;
  cd.forEach(d=>{const pct=d.count/total,dash=pct*circ,gap=circ-dash,c=document.createElementNS('http://www.w3.org/2000/svg','circle');c.setAttribute('cx',cx);c.setAttribute('cy',cy);c.setAttribute('r',r);c.setAttribute('fill','none');c.setAttribute('stroke',d.color);c.setAttribute('stroke-width',sw);c.setAttribute('stroke-dasharray',`${dash} ${gap}`);c.setAttribute('stroke-dashoffset',-off*circ);c.setAttribute('transform',`rotate(-90 ${cx} ${cy})`);svg.appendChild(c);off+=pct;const item=document.createElement('div');item.className='legend-item';item.innerHTML=`<div class="legend-dot" style="background:${d.color}"></div><span>${esc(d.label)}</span><span class="legend-val">${d.count}</span>`;leg.appendChild(item);});
  const t=document.createElementNS('http://www.w3.org/2000/svg','text');t.setAttribute('x',cx);t.setAttribute('y',cy-2);t.setAttribute('text-anchor','middle');t.setAttribute('font-size','17');t.setAttribute('font-weight','800');t.setAttribute('fill','#eceef5');t.setAttribute('font-family','Syne');t.textContent=total;svg.appendChild(t);
  const sub=document.createElementNS('http://www.w3.org/2000/svg','text');sub.setAttribute('x',cx);sub.setAttribute('y',cy+12);sub.setAttribute('text-anchor','middle');sub.setAttribute('font-size','8');sub.setAttribute('fill','#5a6280');sub.setAttribute('font-family','Outfit');sub.textContent='tarefas';svg.appendChild(sub);
}

// â”€â”€â”€ WATER â”€â”€â”€
function renderWater(){
  if(!state.water)state.water={cups:0,goal:8};
  const{cups,goal}=state.water;
  const ec=document.getElementById('w-cups'),eg=document.getElementById('w-goal'),em=document.getElementById('w-ml'),eb=document.getElementById('water-bar'),ecp=document.getElementById('water-cups');
  if(ec)ec.textContent=cups;if(eg)eg.textContent=goal;
  if(em)em.textContent=`${cups*250} ml de ${goal*250} ml`;
  if(eb)eb.style.width=Math.min(cups/goal*100,100)+'%';
  if(ecp){ecp.innerHTML='';for(let i=0;i<goal;i++){const cup=document.createElement('div');cup.className='cup'+(i<cups?' filled':'');cup.onclick=()=>{i<cups?removeWater():addWater();};ecp.appendChild(cup);}}
}
function addWater(){if(!state.water)state.water={cups:0,goal:8};if(state.water.cups>=state.water.goal){showToast('ğŸ‰ Meta atingida!');return;}state.water.cups++;if(state.water.cups===state.water.goal)showToast('ğŸ‰ ParabÃ©ns! Meta atingida!');else showToast('ğŸ’§ +1 copo!');renderWater();save();}
function removeWater(){if(!state.water||state.water.cups<=0)return;state.water.cups--;renderWater();save();}
function resetWater(){state.water={...state.water,cups:0};renderWater();save();showToast('ğŸ’§ Zerado!');}
function editWaterGoal(){const v=prompt('Meta de copos (1â€“20):',state.water?.goal||8);if(!v)return;const n=parseInt(v);if(isNaN(n)||n<1||n>20){alert('Informe entre 1 e 20.');return;}state.water={...state.water,goal:n,cups:Math.min(state.water.cups,n)};renderWater();save();showToast('ğŸ¯ Meta atualizada!');}

// â”€â”€â”€ GOALS â”€â”€â”€
function renderGoals(){
  const list=document.getElementById('goals-list');if(!list)return;list.innerHTML='';
  if(!goals.length){list.innerHTML=`<div class="empty-st"><div class="empty-ico">ğŸ¯</div><div class="empty-tx">Nenhuma meta ainda.<br>Adicione abaixo!</div></div>`;return;}
  goals.forEach(g=>list.appendChild(buildGoalCard(g)));
}
function buildGoalCard(g){
  const cat=CAT[g.category]||CAT.outro;const pct=Math.min(Math.max(parseInt(g.progress)||0,0),100);
  const pc=pct===100?'var(--grn)':pct>=50?'var(--acc)':'var(--ylw)';
  const el=document.createElement('div');el.className='goal-card'+(g.done?' done-g':'');el.id='goal-'+g.id;
  el.innerHTML=`<div class="gc-top"><textarea class="gc-title" rows="1" oninput="ar(this)" onchange="updGoal('${g.id}','title',this.value)" onblur="saveGoals()">${esc(g.title)}</textarea><button class="gc-del" onclick="delGoal('${g.id}')"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
  <div class="gc-meta"><span class="gc-cat" style="background:${cat.bg};color:${cat.c};border:1px solid ${cat.b}">${cat.label}</span><input type="date" class="gc-date" value="${g.deadline||''}" onchange="updGoal('${g.id}','deadline',this.value);saveGoals()"></div>
  <div class="gc-prog-row"><div class="gc-prog-bar"><div class="gc-prog-fill" style="width:${pct}%;background:${pc}"></div></div><input class="gc-prog-inp" type="number" min="0" max="100" value="${pct}" onchange="updGoal('${g.id}','progress',this.value)" onblur="saveGoals()"><span style="font-family:'Syne',sans-serif;font-size:12px;font-weight:700;min-width:36px;text-align:right;color:${pc}">${pct}%</span></div>
  <button class="gc-check ${g.done?'gc-yes':'gc-no'}" onclick="toggleGoal('${g.id}')"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>${g.done?'ConcluÃ­da âœ“':'Marcar como concluÃ­da'}</button>`;
  return el;
}
function addGoal(){const tEl=document.getElementById('goal-title-inp');const title=tEl.value.trim();if(!title){tEl.focus();tEl.style.borderColor='var(--red)';setTimeout(()=>tEl.style.borderColor='',1200);return;}goals.push({id:'g'+(++gCnt),title,category:document.getElementById('goal-cat-inp').value,progress:0,deadline:'',done:false});tEl.value='';saveGoals();renderGoals();showToast('ğŸ¯ Meta adicionada!');}
function updGoal(id,f,v){const g=goals.find(g=>g.id===id);if(!g)return;if(f==='progress')v=Math.min(Math.max(parseInt(v)||0,0),100);g[f]=v;if(f==='progress'||f==='title'){const ex=document.getElementById('goal-'+id);if(ex)ex.replaceWith(buildGoalCard(g));}}
function toggleGoal(id){const g=goals.find(g=>g.id===id);if(!g)return;g.done=!g.done;if(g.done)g.progress=100;saveGoals();renderGoals();showToast(g.done?'ğŸ¯ ConcluÃ­da!':'â†©ï¸ Reaberta!');}
function delGoal(id){const g=goals.find(g=>g.id===id);if(!confirm(`Excluir "${g?.title||'meta'}"?`))return;const row=document.getElementById('goal-'+id);if(row){row.style.cssText='opacity:0;transform:translateX(16px);transition:.22s';setTimeout(()=>{goals=goals.filter(g=>g.id!==id);saveGoals();renderGoals();},230);}else{goals=goals.filter(g=>g.id!==id);saveGoals();renderGoals();}showToast('ğŸ—‘ Meta excluÃ­da');}

// â”€â”€â”€ RESET â”€â”€â”€
function openResetModal(){document.getElementById('reset-overlay').classList.add('open');}
function closeResetModal(){document.getElementById('reset-overlay').classList.remove('open');}
function resetDoneTasks(){state.columns.forEach(col=>col.cards.forEach(c=>c.status='todo'));const col1=state.columns.find(c=>c.id===COL_TODO);state.columns.forEach(col=>{if(col.id!==COL_TODO){col1.cards.push(...col.cards);col.cards=[];}});closeResetModal();renderAll();save();showToast('â†º Tarefas reabertas!');}
function resetAllCards(){if(!confirm('Apagar TODOS os cartÃµes?'))return;Object.keys(timers).forEach(stopTimerInterval);state.columns.forEach(col=>col.cards=[]);closeResetModal();renderAll();save();showToast('ğŸ—‘ Apagado!');}
function resetToDefault(){if(!confirm('Restaurar padrÃ£o? Metas nÃ£o serÃ£o afetadas.'))return;Object.keys(timers).forEach(stopTimerInterval);state=JSON.parse(JSON.stringify(DS));closeResetModal();renderAll();save();showToast('ğŸ”„ Restaurado!');}

// â”€â”€â”€ EXPORT / IMPORT â”€â”€â”€
function exportData(){const blob=new Blob([JSON.stringify({state,goals},null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='vibenith-backup.json';a.click();showToast('ğŸ’¾ Backup salvo!');}
function importData(){const input=document.createElement('input');input.type='file';input.accept='.json';input.onchange=e=>{const r=new FileReader();r.onload=ev=>{try{const d=JSON.parse(ev.target.result);if(d.state)state=d.state;if(d.goals)goals=d.goals;ensureFixedCols();renderAll();renderGoals();save();saveGoals();showToast('ğŸ“‚ Dados carregados!');}catch{alert('Arquivo invÃ¡lido!');}};r.readAsText(e.target.files[0]);};input.click();}

// â”€â”€â”€ UTILS â”€â”€â”€
function esc(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function ar(el){el.style.height='auto';el.style.height=el.scrollHeight+'px';}
let toastTimer;
function showToast(msg){clearTimeout(toastTimer);const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');toastTimer=setTimeout(()=>t.classList.remove('show'),2600);}

// â”€â”€â”€ SWIPE (left/right to switch columns on mobile) â”€â”€â”€
let swipeX=0;
document.getElementById('board').addEventListener('touchstart',e=>{swipeX=e.touches[0].clientX;},{passive:true});
document.getElementById('board').addEventListener('touchend',e=>{
  const dx=e.changedTouches[0].clientX-swipeX;
  if(Math.abs(dx)>60){
    const next=dx<0?Math.min(activeColIdx+1,state.columns.length-1):Math.max(activeColIdx-1,0);
    showColumn(next);
  }
},{passive:true});

['tag-overlay','col-overlay','reset-overlay'].forEach(id=>{document.getElementById(id).addEventListener('click',e=>{if(e.target===e.currentTarget)e.currentTarget.classList.remove('open');});});
document.getElementById('tag-name-input').addEventListener('keydown',e=>{if(e.key==='Enter')confirmAddTag();});
document.getElementById('col-name-input').addEventListener('keydown',e=>{if(e.key==='Enter')confirmAddCol();});
document.getElementById('goal-title-inp').addEventListener('keydown',e=>{if(e.key==='Enter')addGoal();});
document.getElementById('sh-title').addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault();addCardFromSheet();}});

autoLogin();
</script>
</body>
</html>
